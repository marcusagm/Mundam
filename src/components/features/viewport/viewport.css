.grid-placeholder {
  flex: 1;
  overflow: hidden; /* VirtualMasonry manages its own overflow */
  padding: 0; /* Padding handled inside VirtualMasonry for correct calculation */
  position: relative;
}

.virtual-scroll-container {
  width: 100%;
  height: 100%;
  /* Force scrollbar to always be visible to prevent layout oscillation */
  /* When content height oscillates around viewport height, scrollbar appearing/disappearing */
  /* changes container width, causing endless recalculation loop */
  overflow-y: scroll;
  position: relative;
  will-change: transform;
  padding: var(--p-space-s);
  scrollbar-gutter: stable;
}

.virtual-track {
  width: 100%;
  position: relative;
}


.virtual-masonry-item {
  background-color: var(--bg-surface-1);
  border: 3px solid var(--border-default);
  position: absolute;
  overflow: hidden;
  border-radius: 15px;
  /* Transition handled in inline style for transform/width, but we keep border/shadow here */
  transition:
    border-color 0.3s ease,
    box-shadow 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
  display: block;
  cursor: pointer;
  /* Performance optimizations for virtualized items */
  will-change: transform;
  contain: layout paint style;
  content-visibility: auto;
}

.virtual-masonry-item:hover {
  border-color: var(--action-primary-bg);
  /* Transform handled by JS layout OR simple Z-index boost. 
     We CANNOT transform Y here because it conflicts with JS positioning. 
     Instead, usage inner element or box-shadow popup. */
  box-shadow: 0 15px  2.5rem rgba(0, 0, 0, 0.6);
  z-index: 10;
}

.virtual-masonry-item:hover .item-overlay {
  opacity: 1;
}

.virtual-masonry-item.selected {
  border-color: var(--border-active);
  box-shadow: 0 0 0 var(--p-space-xxs) var(--border-active);
  z-index: 5;
}

.virtual-masonry-item:focus {
  outline: none;
}
.virtual-masonry-item.focused {
  box-shadow: var(--shadow-focus);
  z-index: 6;
}
.virtual-masonry-item.focused.selected {
  box-shadow: var(--shadow-focus-selected);
  z-index: 6;
}

.virtual-masonry-item.focused.selected {
  outline-color: var(--border-active);
}

/* Legacy/CSS-only Masonry (CSS Columns) */
.masonry-grid {
  columns: 4 280px;
  column-gap: var(--p-space-m);
  width: 100%;
}

.masonry-item {
  break-inside: avoid;
  margin-bottom: var(--p-space-m);
  background-color: var(--bg-surface-1);
  border: 1px solid var(--border-default);
  position: relative;
  overflow: hidden;
  transition:
    border-color 0.3s ease,
    transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1),
    box-shadow 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
  display: block;
  cursor: pointer;
  will-change: transform, box-shadow;
}

.masonry-item:hover {
  border-color: var(--action-primary-bg);
  transform: translateY(-6px);
  box-shadow: 0 15px  2.5rem rgba(0, 0, 0, 0.6);
  z-index: 10;
}

.masonry-item:hover img {
  transform: scale(1.04);
}

.virtual-masonry-item:hover img {
  transform: scale(1.04);
}

.virtual-masonry-item.drop-target-active {
  border-color: var(--action-primary-bg) !important;
  box-shadow: 
    0 0 0  0.625rem rgba(var(--accent-color-rgb), 0.2),
    0 var(--p-space-s) 30px rgba(0, 0, 0, 0.5);
  background-color: var(--bg-surface-active);
  z-index: 20;
}

.virtual-masonry-item.drop-target-active::after {
  content: '';
  position: absolute;
  inset: 0;
  /* border:  0.375rem solid var(--action-primary-bg); */
  -webkit-box-shadow: inset 0px 0px  1.25rem  0.375rem var(--action-primary-bg); 
  box-shadow: inset 0px 0px  1.25rem  0.375rem var(--action-primary-bg);
  /* border-radius: inherit; */
  pointer-events: none;
  animation: pulse-border 1.5s infinite;
}

@keyframes pulse-border {
  0% { 
    opacity: 1; 
    /* border-width:  0.375rem;  */
    box-shadow: inset 0px 0px  0.625rem 0px var(--action-primary-bg); 
    -webkit-box-shadow: inset 0px 0px  0.625rem 0px var(--action-primary-bg); 
  }
  50% { 
    opacity: 0.5; 
    /* border-width:  0.625rem;  */
    box-shadow: inset 0px 0px  0.625rem  0.375rem var(--action-primary-bg); 
    -webkit-box-shadow: inset 0px 0px  0.625rem  0.375rem var(--action-primary-bg); 
  }
  100% { 
    opacity: 1; 
    /* border-width:  0.375rem;  */
    box-shadow: inset 0px 0px  0.625rem 0px var(--action-primary-bg); 
    -webkit-box-shadow: inset 0px 0px  0.625rem 0px var(--action-primary-bg); 
  }
}

.item-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 0.75rem var(--p-space-s);
  background: linear-gradient(to top, rgba(0, 0, 0, 0.95), transparent);
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
  z-index: 3;
}

.masonry-item:hover .item-overlay {
  opacity: 1;
}